/**
 * @gdjiami/gzb-jssdk - 1.10.0
 * https://github.com/jmopen/gzb-jssdk#readme
 * Copyright(c) 2020 ivan
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.GZB={})}(this,function(e){"use strict";function t(e,t){function n(){this.constructor=e}y(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function n(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})}function r(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s}function i(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function o(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e}function a(e){if(null==e)return e;if("string"==typeof e)return e.length>2e3?e.substr(0,2e3)+"...":e;if(Array.isArray(e))return e.map(a);if("object"==typeof e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=a(e[n]));return t}return e}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}function c(e,t,n){if(s("[GZB JSSDK deprecated]: "+e),t)return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.apply(n,e)}}function l(){}function u(e){return e}function d(e){return""+e.substr(0,1).toUpperCase()+e.substr(1)}function p(e,t){if(void 0===t&&(t=!1),!(e instanceof Date)){if("string"==typeof e){var n=new Date(e);if(Number.isNaN(n.getTime())){var r=Number.parseInt(e);if(Number.isNaN(r))throw new TypeError(e+" is not a valid Date");return t?new Date(1e3*r):new Date(r)}return n}return t?new Date(1e3*e):new Date(e)}return e}function f(e){return"string"==typeof e?JSON.parse(e):e}function h(e,t){return"'"+e+"' 方法已经废弃, 请使用 "+t+" 方法代替."}function g(e){c(e+" 方法: 回调形式的API调用已经废弃， 请使用Promise来获取返回值和捕获错误")}function v(){return(E.windows()?J:V).getInstance()}var y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},b=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},w=Object.freeze({bigStringTransform:a,debug:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},warn:s,deprecated:c,noop:l,identity:u,upperFirst:d,parseDate:p,dateFormat:function(e,t,n){void 0===e&&(e=new Date),void 0===t&&(t="YYYY-MM-DD"),void 0===n&&(n=!1);var r=p(e,n),i=r.getFullYear(),o=r.getMonth()+1,a=r.getDate(),s=r.getHours(),c=s<=12?s:s-12,l=r.getMinutes(),u=r.getSeconds(),d={YYYY:i,MM:("0"+o).slice(-2),M:o,DD:("0"+a).slice(-2),D:a,H:s,HH:("0"+s).slice(-2),h:c,hh:("0"+c).slice(-2),m:l,mm:("0"+l).slice(-2),s:u,ss:("0"+u).slice(-2)};return t.replace(/Y+|M+|D+|H+|h+|m+|s+/g,function(e){return d[e]})},outOfChina:function(e,t){return e<72.004||t>137.8347||e<.8293||t>55.8271}}),m=0,B={beforeSend:function(e){return e?JSON.stringify(e):void 0},afterReceived:u,preserveName:!1},k=function(){function e(){this.listeners={},this.responseCallbacks={},void 0===window.HandleEvent&&console.warn("[Window Bridge] 初始化异常，window.HandleEvent 为undefined. 这可能说明SDK运行在没有Bridge的环境\n        请使用Device.bridgeAvailable()来判断当前环境是否支持。\n        ")}return e.getInstance=function(){return null==this.instance?this.instance=new e:this.instance},e.getNormalizedBridge=function(){var e=this.getInstance();return null==this.normalizedBridge?this.normalizedBridge={init:function(){s("bridge.init 已废弃")},callHandler:function(t,n,r){e.emit("[s]"+t,n,r)},registerHandler:function(t,n){e.addListener("[c]"+t,n)}}:this.normalizedBridge},e.prototype.emit=function(e,t,n){var r=this,i=this.listeners[e];if(!i||!i.length)throw new Error("[Windows Bridge]: "+e+" not registered(PC 端未支持该接口)");i.forEach(function(e){return e.call(r,t,n)})},e.prototype.addListener=function(e,t){var n=this,r=this.listeners[e]||[];return this.listeners[e]=r.concat(t),function(){n.removeListener(e,t)}},e.prototype.removeListener=function(e,t){var n=this.listeners[e];if(n&&n.length){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}},e.prototype.addCallback=function(e,t,n){return void 0===n&&(n="cb_"+e+"_"+m++),this.responseCallbacks[n]=t,n},e.prototype.callCallback=function(e,t){var n=this.responseCallbacks[e];n&&n(t),delete this.responseCallbacks[e]},e.prototype.registerHandler=function(e,t){var n=this;void 0===t&&(t={});var r=b({},B,t);return this.registerBridgeHandler(e,function(t,i){var o;"function"==typeof i&&(o=n.addCallback(e,function(e){i(r.afterReceived(e))}));var a=r.bridgeHandleName||(r.preserveName?e:"On"+d(e)),s=r.beforeSend(t);window.HandleEvent(a,s,o)}),this},e.prototype.deprecatedRegisterHandler=function(e,t){return this.registerBridgeHandler.call(this,e,t),this},e.prototype.callClientHandler=function(e,t,n){this.emit("[c]"+e,t,n)},e.prototype.registerBridgeHandler=function(e,t){this.addListener("[s]"+e,t)},e}();window.exeCallback=function(e,t){k.getInstance().callCallback(t,e)};var H,C=function(){function e(){this.androidBridgeInitialized=!1}return e.getInstance=function(){return this.instance?this.instance:this.instance=new e},e.prototype.setUpBridge=function(e){var t=this;if(E.miniprogram())console.warn("小程序不支持gzb-jssdk");else{var n=e;if(n=function(t){var n=b({},t),r=t.callHandler;n.callHandler=function(e,t,n){return r(e,t,function(e){e&&"string"==typeof e&&(e=JSON.parse(e)),"function"==typeof n&&n(e)})},e(n)},window.WebViewJavascriptBridge)void 0===window.WebViewJavascriptBridge.init&&(window.WebViewJavascriptBridge.init=l),!this.androidBridgeInitialized&&E.android()&&(window.WebViewJavascriptBridge.init(),this.androidBridgeInitialized=!0),n(window.WebViewJavascriptBridge);else if(window.WVJBCallbacks)window.WVJBCallbacks.push(n);else if(window.WVJBCallbacks=[n],E.android())document.addEventListener("WebViewJavascriptBridgeReady",function(){"function"==typeof window.WebViewJavascriptBridge.init&&(window.WebViewJavascriptBridge.init(),t.androidBridgeInitialized=!0);var e=window.WVJBCallbacks;delete window.WVJBCallbacks,e.forEach(function(e){e(window.WebViewJavascriptBridge)})},!1);else{var r=document.createElement("iframe");r.style.display="none",r.src="https://__bridge_loaded__",document.documentElement.appendChild(r),setTimeout(function(){document.documentElement.removeChild(r)},0)}}},e}(),U=function(e){function n(t,r){var i=e.call(this,r)||this;return i.errCode=t,Object.setPrototypeOf(i,n.prototype),i}return t(n,e),n}(Error),W=function(){function e(){this.initializeUserAgent()}return e.prototype.webkit=function(){return this.find("applewebkit")},e.prototype.isGZB=function(){return this.find("gzb")},e.prototype.bridgeAvailable=function(){var e=this;return new Promise(function(t){if(e.isGZB())t(!0);else{if(e.windows())return t(null!=window.HandleEvent);e.ios()||e.android()||e.mac()?null!=window.WebViewJavascriptBridge?t(!0):C.getInstance().setUpBridge(function(e){t(!0)}):t(!1)}})},e.prototype.windows=function(){return this.find("windows")},e.prototype.windowsPhone=function(){return this.windows()&&this.find("phone")},e.prototype.windowsTablet=function(){return this.windows()&&!this.find("phone")&&this.find("touch")},e.prototype.iphone=function(){return!this.windows()&&this.find("iphone")},e.prototype.ipad=function(){return this.find("ipad")},e.prototype.ipod=function(){return this.find("ipod")},e.prototype.ios=function(){return this.iphone()||this.ipad()||this.ipod()},e.prototype.android=function(){return!this.windows()&&this.find("android")},e.prototype.androidPhone=function(){return this.android()&&this.find("mobile")},e.prototype.androidTablet=function(){return this.android()&&!this.find("mobile")},e.prototype.mac=function(){return this.find("macintosh")},e.prototype.blackberry=function(){return this.find("blackberry")||this.find("bb10")||this.find("rim")},e.prototype.blackberryPhone=function(){return this.blackberry()&&!this.find("tablet")},e.prototype.blackberryTablet=function(){return this.blackberry()&&this.find("tablet")},e.prototype.miniprogram=function(){return this.find("miniprogram")},e.prototype.mobile=function(){return this.androidPhone()||this.iphone()||this.ipod()||this.windowsPhone()||this.blackberryPhone()},e.prototype.tablet=function(){return this.ipad()||this.androidTablet()||this.blackberryTablet()||this.windowsTablet()},e.prototype.desktop=function(){return!this.mobile()&&!this.tablet()},e.prototype.portrait=function(){return window.innerHeight/window.innerWidth>1},e.prototype.landscape=function(){return!this.portrait()},e.prototype.setUserAgent=function(e){this.userAgent=e},e.prototype.initializeUserAgent=function(){this.userAgent=window.navigator.userAgent.toLowerCase()},e.prototype.find=function(e){return-1!==this.userAgent.indexOf(e)},e}(),E=new W,L=function(){function e(e,t){this.cancelable=!1,this.timeStamp=Date.now(),this.eventPrevented=!1,this.type=e,t&&(this.cancelable=t.cancelable||!1)}return Object.defineProperty(e.prototype,"defaultPrevented",{get:function(){return this.eventPrevented},enumerable:!0,configurable:!0}),e.prototype.preventDefault=function(){this.cancelable&&(this.eventPrevented=!0)},e}(),I=function(){function e(){this.listeners={}}return e.prototype.addListener=function(e,t,n,r){var i=this;void 0===r&&(r=!1);var o=this.listeners[e]||[],a={callback:t,context:n,once:r};return this.listeners[e]=o.concat(a),function(){return i.removeListener(e,t)}},e.prototype.once=function(e,t,n){return this.addListener(e,t,n,!0)},e.prototype.getListenerLength=function(e){return this.listeners[e]?this.listeners[e].length:0},e.prototype.removeAllListener=function(e){var t=(this.listeners[e]||[]).length;return delete this.listeners[e],t},e.prototype.removeListener=function(e,t,n){var r=this.listeners[e];if(r&&r.length)for(var i=0;i<r.length;i++){var o=r[i],a=o.callback,s=o.context;if(a===t&&s===n)return r.splice(i,1),!0}return!1},e.prototype.emit=function(e,t){var n=this.listeners[e],r=[];if(n&&n.length)for(var i=o(n),a=!1,s=0;s<i.length;s++){var c=i[s],l=c.callback,u=c.context;if(c.once&&this.removeListener(e,l,u),a)r.push(void 0);else{var d=l.call(u,t);!1===d&&(a=!0),r.push(d)}}return r},e}(),O="exitWebApp",_="ready",M=Object.freeze({beforeunload:"beforeunload",beforegoback:"beforegoback",ready:_}),N={hideMoreBtn:!1,left:["close","goback"],onlyCallBack:[],gobackUrl:"",right:""},T={enableHighAccuracy:!0,preferNative:!0,timeout:1/0,watch:!1,maximumAge:0},D={quality:100,targetType:"default",extType:[],maxSizeKb:0},A={multiple:!0},P=0,x=function(e){function n(){var t=e.call(this)||this;return t.menuItems={},t.isReady=!1,t.exit=function(){t.setUpBridge(function(e){e.callHandler(O,void 0)})},setTimeout(function(){t.setupEventWatchers(),E.bridgeAvailable().then(function(){var e=new L(_);t.emit(_,e),t.isReady=!0,t.innerAddEventListener("__addListener__",function(n){n===_&&t.emit(_,e)})})},0),t}return t(n,e),n.prototype.addListener=function(t,n,r){var i=this;return setTimeout(function(){i.emit("__addListener__",{eventType:t})},0),e.prototype.addListener.call(this,t,n,r)},n.prototype.removeListener=function(t,n,r){var i=this,o=e.prototype.removeListener.call(this,t,n,r);return o&&setTimeout(function(){i.emit("__removeListener__",{eventType:t,count:1})},0),o},n.prototype.removeAllListener=function(t){var n=this,r=e.prototype.removeAllListener.call(this,t);return r&&setTimeout(function(){n.emit("__removeListener__",{eventType:t,count:r})},0),r},n.prototype.call=function(e){this.setUpBridge(e)},n.prototype.setTitle=function(e){var t=this;E.bridgeAvailable().then(function(n){n?t.setUpBridge(function(t){t.callHandler("setWebTitle",{title:e})}):document.title=e})},n.prototype.phone=function(e){this.setUpBridge(function(t){t.callHandler("makeCallToNumber",{callNumber:e})})},n.prototype.sms=function(e){this.setUpBridge(function(t){t.callHandler("sendSmsToNumber",{callNumber:e})})},n.prototype.mail=function(e){var t=this;E.bridgeAvailable().then(function(n){if(n)t.setUpBridge(function(t){t.callHandler("openMail",{email:e})});else{var r=document.createElement("a");r.href="mailto:"+e,r.click()}})},n.prototype.locationTo=function(e){var t=this;E.bridgeAvailable().then(function(n){var r="string"==typeof e?{url:e,showMode:"outer"}:b({showMode:"outer"},e);n?t.setUpBridge(function(e){e.callHandler("openUrl",r)}):"outer"===r.showMode?window.open(r.url):location.href=r.url})},n.prototype.url=function(e){return c(h("url","locationTo"),this.locationTo,this)(e)},n.prototype.showContact=function(e){this.setUpBridge(function(t){t.callHandler("openContactItem",{id:e})})},n.prototype.openContact=function(e){this.showContact(e)},n.prototype.selectContact=function(e,t){var n=this,r=b({user:[],type:"multiple",unselect:!0,limit:1e4},e);return new Promise(function(e,i){n.setUpBridge(function(n){n.callHandler("openContact",r,function(n){try{var r=f(n);"function"==typeof t&&(g("selectContact"),t(r)),e(r)}catch(e){i(e)}})})})},n.prototype.setBarColor=function(e){this.setUpBridge(function(t){t.callHandler("setBarColor",{color:e})})},n.prototype.setBarVisible=function(e){this.setUpBridge(function(t){t.callHandler("showBar",{flag:!e})})},n.prototype.showBar=function(e){E.windows()?this.setUpBridge(function(e){e.callHandler("showMenu",null)}):this.setBarVisible(!e||!0)},n.prototype.hideBar=function(){this.setBarVisible(!1)},n.prototype.settingBar=function(e,t){c("settingBar 已经废弃");var n=b({},N,e);this.setUpBridge(function(e){e.callHandler("setBar",b({},n,{hideMoreBtn:n.hideMoreBtn.toString()}),function(e){var n=f(e);"function"==typeof t&&t(n)})})},n.prototype.exitApp=function(){return c(h("exitApp","exit"),this.exit,this)()},n.prototype.date=function(){c("date() 方法已废弃， 请使用客户端日期组件代替")},n.prototype.getLocation=function(e,t){var n=this,r="function"==typeof e||null==e?T:b({},T,e),i="function"==typeof e?e:t;return new Promise(function(e,t){r.preferNative?(delete r.preferNative,n.setUpBridge(function(n){n.callHandler("getLocation",r,function(n){try{var r=f(n);if(!Array.isArray(r))throw new U(r.errCode,"获取位置失败");var o=f(n)[0],a=o.address,s=o.coordType,c=parseFloat(o.latitude),l=parseFloat(o.longitude),u=parseFloat(o.speed),d={latitude:c,longitude:l,address:a,speed:u=1e3*u/3600,accuracy:parseFloat(o.accuracy),coordType:"bd09ll"===s?"BD09":s};"function"==typeof i&&(g("getLocation"),i(d)),e(d)}catch(e){t(e)}})})):navigator.geolocation.getCurrentPosition(function(t){var n=t.coords,r={latitude:n.latitude,longitude:n.longitude,accuracy:n.accuracy,speed:n.speed,coordType:"WGS84"};"function"==typeof i&&i(r),e(r)},function(e){var n=e.code,r=e.message;t(new U(n,r))},r)})},n.prototype.getLoc=function(e){c(h("getLoc","getLocation"),this.getLocation,this)(e)},n.prototype.geoNavigate=function(e,t){this.setUpBridge(function(n){var r={to:t,from:e,coordType:"WGS84"};n.callHandler("geoNavigate",r)})},n.prototype.apiInfos=function(e){var t=this;return new Promise(function(n,r){t.setUpBridge(function(t){t.callHandler("apiList",null,function(t){try{var i=f(t);"function"==typeof e&&(g("apiInfos"),e(i)),n({platform:i.plat,version:i.version,API:i.apilist})}catch(e){r(e)}})})})},n.prototype.getList=function(e){c(h("getList","apiInfos"),this.apiInfos,this)(e)},n.prototype.scanQRCode=function(e,t){var n=this,r="boolean"!=typeof e||e,i="function"==typeof e?e:t;return new Promise(function(e,t){n.setUpBridge(function(n){n.callHandler("scanQRCode",{needResult:r},function(n){try{var r=f(n);"function"==typeof i&&(g("scanQRCode"),i(r)),e(r)}catch(e){t(e)}})})})},n.prototype.QRcode=function(e,t){c(h("QRcode","scanQRCode"),this.scanQRCode)(e,t)},n.prototype.shareTo=function(){this.setUpBridge(function(e){e.callHandler("shareTo",null)})},n.prototype.openDialog=function(e){this.setUpBridge(function(t){t.callHandler("openDialog",e)})},n.prototype.Dialog=function(e,t){var n="object"==typeof e?e:{type:e,id:t};c(h("Dialog","openDialog"),this.openDialog)(n)},n.prototype.chooseImg=function(e,t){var n=this,r=null==e||"function"==typeof e?D:b({},D,e),i="function"==typeof e?e:t;return new Promise(function(e,t){n.setUpBridge(function(n){n.callHandler("chooseImg",r,function(n){try{var r=f(n);if("function"==typeof i&&(g("chooseImg"),i(r)),"true"===r.result){var o=r.imgData,a=r.imgHeight,s=r.imgWidth,c=r.imgType,l=r.quality;e({dataUrl:o,width:s,height:a,extension:c,quality:l})}else{var u=new U(r.errCode,r.errMsg);t(u)}}catch(e){t(e)}})})})},n.prototype.previewImg=function(e){var t=this;return new Promise(function(n,r){t.setUpBridge(function(t){t.callHandler("previewImg",e,function(e){try{var t=f(e);"true"===t.result?n():r(new U(t.errCode,t.errMsg))}catch(e){r(e)}})})})},n.prototype.openFile=function(e){var t=this;return new Promise(function(n,r){E.bridgeAvailable().then(function(i){i&&E.windows()?t.setUpBridge(function(t){t.callHandler("openFile",{url:e},function(e){var t=f(e);("boolean"==typeof t.result?t.result:"true"===t.result)?n():r(new U(t.errCode,t.errMsg))})}):(window.open(e),n())})})},n.prototype.openVideo=function(e,t){this.setUpBridge(function(n){n.callHandler("openVideo",{url:e,extType:t})})},n.prototype.addMenuItem=function(e,t){this.addNativeMenuItem({id:String(P++),title:e},t)},n.prototype.removeMenuItem=function(e){var t=this;e in this.menuItems&&this.setUpBridge(function(n){n.callHandler("removeMenuItem",{ids:[t.menuItems[e]]}),delete t.menuItems[e]})},n.prototype.setNativeMenuItem=function(e){this.setUpBridge(function(t){t.callHandler("setNativeMenuItem",e)})},n.prototype.selectSession=function(e,t){var n=this,r=null==e||"function"==typeof e?A:b({},A,e),i="function"==typeof e?e:t;return new Promise(function(e,t){n.setUpBridge(function(n){n.callHandler("selectSession",r,function(n){try{var r=f(n);if("function"==typeof i&&(g("SelectSession"),i(r)),"true"===r.result)e(r.session);else{var o=new U(r.errCode,r.errMsg);t(o)}}catch(e){t(e)}})})})},n.prototype.getLanguage=function(e){var t=this;return new Promise(function(n,r){t.setUpBridge(function(t){t.callHandler("getLanguage",null,function(t){try{var i=f(t);if("function"==typeof e&&(g("getLanguage"),e(i)),"true"===i.result)n(i.language);else{var o=new U(i.errCode,i.errMsg);r(o)}}catch(e){r(e)}})})})},n.prototype.goback=function(){var e=this,t=window.location.href;window.history.go(-1),setTimeout(function(){window.location.href===t&&e.exit()},500)},n.prototype.teardown=function(){this.teardownEventWatchers()},n.prototype.addNativeMenuItem=function(e,t){var n=this,r=e.id,i=e.title;this.setUpBridge(function(o){n.menuItems[i]=r,o.callHandler("addMenuItem",e,function(r){var o=f(r);"true"===o.result?(t(null),i in n.menuItems&&n.addNativeMenuItem(e,t)):t(new U(o.errCode,o.errMsg))})})},n.prototype.setupEventWatchers=function(){this.setupBeforeUnloadWatcher(),this.setupBeforeGoBackWatcher()},n.prototype.teardownEventWatchers=function(){this.teardownBeforeUnloadWatcher(),this.teardownBeforeGoBackWatcher()},n.prototype.innerAddEventListener=function(t,n){return e.prototype.addListener.call(this,t,n)},n.prototype.setupBeforeGoBackWatcher=function(){var e=this;this.setupEventWatcher("beforegoback",function(){var t=new L("beforegoback",{cancelable:!0}),n=e.emit("beforegoback",t);t.defaultPrevented||n.some(function(e){return!1===e})||e.goback()})},n.prototype.teardownBeforeGoBackWatcher=function(){this.teardownEventWatcher("beforegoback")},n.prototype.teardownBeforeUnloadWatcher=function(){this.teardownEventWatcher("beforeunload")},n.prototype.setupBeforeUnloadWatcher=function(){var e=this,t=function(e){return e.some(function(e){return!1===e||"string"==typeof e&&""!==e})},n=function(e){return e.find(function(e){return"string"==typeof e&&""!==e})};this.setupEventWatcher("beforeunload",function(){var r=new L("beforeunload",{cancelable:!0}),i=e.emit("beforeunload",r);if(t(i)||r.defaultPrevented){var o=n(i)||r.returnValue;o&&window.confirm(o)&&e.exit()}else e.exit()})},n}(I),S={hideMoreBtn:!1,left:["goback","close"],onlyCallBack:[],gobackUrl:"",right:""},V=function(e){function n(){var t=e.call(this)||this;return t.listenerCount={beforegoback:0,beforeunload:0},t.setBarOptions=b({},S,{left:["goback","close"],onlyCallBack:[]}),t.mobileBridge=C.getInstance(),t}return t(n,e),n.getInstance=function(){return null==this.instance?this.instance=new n:this.instance},n.prototype.getBackButtonVisible=function(){return-1!==this.setBarOptions.left.indexOf("goback")},n.prototype.getCloseButtonVisible=function(){return-1!==this.setBarOptions.left.indexOf("close")},n.prototype.getMoreButtonVisible=function(){return!this.setBarOptions.hideMoreBtn},n.prototype.setMoreButtonVisible=function(e){void 0===e&&(e=!0),this.setBarOptions.hideMoreBtn=!e,this.setupBarWatcher()},n.prototype.setBackButtonVisible=function(e){void 0===e&&(e=!0),this.setBarButtonVisible(e,"goback")},n.prototype.setCloseButtonVisible=function(e){void 0===e&&(e=!0),this.setBarButtonVisible(e,"close")},n.prototype.setupEventWatcher=function(e,t){switch(e){case"beforeunload":this.setUpBeforeUnloadWatcher(t);break;case"beforegoback":this.setUpGobackWatcher(t);break;default:throw new Error("未知事件: "+e)}},n.prototype.teardownEventWatcher=function(e){switch(e){case"beforeunload":case"beforegoback":this._teardownBeforeUnloadWatcher();break;default:throw new Error("未知事件: "+e)}},n.prototype.setUpBridge=function(e){var t=this;window.setTimeout(function(){t.mobileBridge.setUpBridge(e)},0)},n.prototype.setBarButtonVisible=function(e,t){var n=this.setBarOptions.left.indexOf(t);e&&-1===n?(this.setBarOptions.left.push(t),this.setupBarWatcher()):e||-1===n||(this.setBarOptions.left.splice(n,1),this.setupBarWatcher())},n.prototype.checkBarWatcher=function(e,t){if(this.listenerCount[t]&&-1!==this.setBarOptions.left.indexOf(e))-1===this.setBarOptions.onlyCallBack.indexOf(e)&&this.setBarOptions.onlyCallBack.push(e);else{var n=this.setBarOptions.onlyCallBack.indexOf(e);-1!==n&&this.setBarOptions.onlyCallBack.splice(n,1)}},n.prototype.setupBarWatcher=function(){var e=this;this.checkBarWatcher("goback","beforegoback"),this.checkBarWatcher("close","beforeunload"),this.setUpBridge(function(t){t.callHandler("setBar",b({},e.setBarOptions,{hideMoreBtn:e.setBarOptions.hideMoreBtn.toString()}),function(t){if(setTimeout(function(){e.setupBarWatcher()},0),"true"===t.result){var n="close"===t.buttonId?e.closeCallback:"goback"===t.buttonId?e.gobackCallback:null;n&&n()}})})},n.prototype._teardownBeforeUnloadWatcher=function(){this.setUpBridge(function(e){e.callHandler("setBar",b({},S,{hideMoreBtn:"false"}))})},n.prototype.watchListener=function(e){var t=this;this.innerAddEventListener("__addListener__",function(n){n.eventType===M[e]&&(t.listenerCount[e]++,t.setupBarWatcher())}),this.innerAddEventListener("__removeListener__",function(n){var r=n.eventType,i=n.count;r===M[e]&&(t.listenerCount[e]-=i,t.setupBarWatcher())}),(this.listenerCount[e]=this.getListenerLength(e))&&setTimeout(function(){t.setupBarWatcher()})},n.prototype.setUpBeforeUnloadWatcher=function(e){this.closeCallback=e,this.watchListener("beforeunload")},n.prototype.setUpGobackWatcher=function(e){this.gobackCallback=e,this.watchListener("beforegoback")},n}(x),J=function(e){function n(){var t=e.call(this)||this;return t.eventDesc={},t.prepareEventWatcher=function(e,n,r){var i=t.eventDesc[e]={count:0,callback:n,nativeEventName:r,eventName:e};t.innerAddEventListener("__addListener__",function(n){n.eventType===e&&(0===i.count&&t.setUpHandler(i.nativeEventName,i.callback),i.count++)}),t.innerAddEventListener("__removeListener__",function(n){var r=n.eventType,o=n.count;r===e&&(i.count-=o,0===i.count&&t.tearDownHandler(i.nativeEventName))})},t.setUpHandler=function(e,n){t.setUpBridge(function(r){r.callHandler(e,null,function(){n(),t.setUpHandler(e,n)})})},t.tearDownHandler=function(e){t.setUpBridge(function(t){t.callHandler(e,null)})},t.initializeBridge(),t}return t(n,e),n.getInstance=function(){return null==this.instance?this.instance=new n:this.instance},n.prototype.setUpBridge=function(e){var t=this;window.setTimeout(function(){e(t.bridge)},0)},n.prototype.setupEventWatcher=function(e,t){switch(e){case"beforeunload":this.prepareEventWatcher(e,t,"windowClose");break;case"beforegoback":this.prepareEventWatcher(e,t,"pgGoBack");break;default:throw new Error("未知事件: "+e)}},n.prototype.teardownEventWatcher=function(e){switch(e){case"beforeunload":case"beforegoback":this.tearDownHandler(this.eventDesc[e].nativeEventName),delete this.eventDesc[e];break;default:throw new Error("未知事件: "+e)}},n.prototype.initializeBridge=function(){this.bridge=k.getNormalizedBridge(),k.getInstance().registerHandler("setWebTitle",{beforeSend:function(e){return e.title}}).registerHandler("chooseImg").registerHandler("makeCallToNumber",{beforeSend:function(e){return e.callNumber}}).registerHandler("openMail",{beforeSend:function(e){return e.email}}).deprecatedRegisterHandler("openUrl",function(e){window.HandleEvent("On"+d("openUrl"),e.url,JSON.stringify(e))}).registerHandler("openContactItem",{beforeSend:function(e){return e.id}}).registerHandler("showMenu").registerHandler(O,{preserveName:!0}).registerHandler("apiList",{bridgeHandleName:"OnGetApiList"}).registerHandler("openDialog").registerHandler("openContact").registerHandler("selectSession").registerHandler("getLanguage").registerHandler("windowClose").registerHandler("pgGoBack").registerHandler("previewImg").registerHandler("openFile").registerHandler("addMenuItem").registerHandler("removeMenuItem").registerHandler("setNativeMenuItem").registerHandler("getEnvironment").registerHandler("openVideo")},n}(x);!function(e){e[e.NotFound=404]="NotFound",e[e.ClientError=500]="ClientError"}(H||(H={}));var j="rpc",z=function(e){function n(t,r,i){var o=e.call(this,r)||this;return o.code=t,o.error=i,Object.setPrototypeOf(o,n.prototype),o}return t(n,e),n}(Error),R=function(e){function n(t,r,i){var o=e.call(this,r)||this;return o.code=t,o.data=i,Object.setPrototypeOf(o,n.prototype),o}return t(n,e),n}(Error),G=function(){function e(){var e=this;this.uid=0,this.handlers={},this._callHandler=function(t,i){return n(e,void 0,void 0,function(){var e,n,o,a,s,c,l,u,d;return r(this,function(r){switch(r.label){case 0:return e=t.id,n=t.params,o=t.method,a=null==e,s=this.handlers[o],c=function(t){i({jsonrpc:"2.0",id:e,result:t})},l=function(t,n,r){i({jsonrpc:"2.0",id:e,error:{code:t,message:n,data:r}})},a||1===s.callback.length?a?(s.callback.forEach(function(e){e(n)}),[3,4]):[3,1]:(console.warn("[gzb-jssdk]: 未注册"+o+"供客户端调用"),l(H.NotFound,"接口未注册"),[2]);case 1:return r.trys.push([1,3,,4]),[4,s.callback[0](n)];case 2:return u=r.sent(),c(u),[3,4];case 3:return(d=r.sent())instanceof R?l(d.code,d.message,d.data):l(H.ClientError,d.message),[3,4];case 4:return[2]}})})},E.windows()?(this.bridge={setUpBridge:function(e){e(k.getNormalizedBridge())}},k.getInstance().registerHandler(j)):this.bridge=C.getInstance(),this.setupClientHandlers()}return e.getInstance=function(){return this.instance?this.instance:this.instance=new e},e.prototype.raw=function(e,t){return n(this,void 0,void 0,function(){var n=this;return r(this,function(r){return[2,new Promise(function(r,i){n.bridge.setUpBridge(function(n){var o="id"in e?function(t){try{if(t){var n=void 0;if(!("id"in(n="string"==typeof t?JSON.parse(t):t))||n.id!==e.id)return void i(new z(0,"协议错误：id为空或不匹配"));r(n)}else i(new z(0,"协议错误：响应为空"))}catch(e){i(new z(0,"协议错误: JSON解析失败("+e.message+")"))}}:"function"==typeof t?t:void 0;n.callHandler(j,e,o),null==o&&r()})})]})})},e.prototype.request=function(e,t){return n(this,void 0,void 0,function(){var n,i,o;return r(this,function(r){switch(r.label){case 0:return n=""+Date.now()+this.uid++,i={jsonrpc:"2.0",id:n,method:e,params:t},[4,this.raw(i)];case 1:if(o=r.sent(),this.isError(o))throw new z(o.error.code,o.error.message,o.error);return[2,o.result]}})})},e.prototype.isError=function(e){return"error"in e},e.prototype.addListener=function(e,t,n){var r={jsonrpc:"2.0",method:e,params:n};this.raw(r,t)},e.prototype.emit=function(e,t){var n={jsonrpc:"2.0",method:e,params:t};this.raw(n)},e.prototype.registerHandler=function(e,t){var n=this;if(this.handlers[e]&&this.handlers[e].callback&&this.handlers[e].callback.length)throw new Error("[gzb-jssdk]: "+e+" 方法已存在处理器");return this.handlers[e]={callback:[t]},function(){return n.removeHandler(e,t)}},e.prototype.registerEventHandler=function(e,t){var n=this;return this.handlers[e]&&this.handlers[e].callback?this.handlers[e].callback.push(t):this.handlers[e]={callback:[t]},function(){return n.removeHandler(e,t)}},e.prototype.removeHandler=function(e,t){if(this.handlers[e]&&this.handlers[e].callback){var n=this.handlers[e].callback.indexOf(t);-1!==n&&this.handlers[e].callback.splice(n,1)}},e.prototype.setupClientHandlers=function(){var e=this;this.bridge.setUpBridge(function(t){t.registerHandler?t.registerHandler(j,e._callHandler):console.warn("客户端未提供registerHandler")})},e}();!function(e){e[e.GroupChat=1]="GroupChat",e[e.Chat=2]="Chat",e[e.Announcement=3]="Announcement",e[e.Visitor=4]="Visitor"}(e.DialogType||(e.DialogType={})),function(e){e[e.Hidden=0]="Hidden",e[e.User=1]="User",e[e.Group=2]="Group",e[e.Visitor=4]="Visitor",e[e.CallUser=8]="CallUser",e[e.All=255]="All"}(e.RecentContactsController||(e.RecentContactsController={})),function(e){e.refresh="refresh",e.share="share",e.copyLink="copyLink",e.openWithBrowser="openWithBrowser"}(e.NativeMenuItem||(e.NativeMenuItem={}));var F="JH.Detector已经废弃，请使用`import { Device } from 'gzb-jssdk'`代替",Y=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.Android=c(F,t.android,t),t.BlackBerry=c(F,t.blackberry,t),t.IOS=c(F,t.ios,t),t.Windows=c(F,t.windows,t),t.isMobile=c(F,t.mobile,t),t.isWebkit=c(F,t.webkit,t),t.isiPad=c(F,t.ipad,t),t.isiPhone=c(F,t.iphone,t),t.isiPod=c(F,t.ipod,t),t}return t(n,e),n}(W);window.customApi={init:v},window.JH={Detector:new Y},e.Api=x,e.BridgeResponseError=U,e.DesktopApi=J,e.Device=E,e.DeviceDector=W,e.EventEmitter=I,e.CustomEvent=L,e.MobileApi=V,e.Utils=w,e.VERSION="1.5.7",e.RPC=G,e.RPCError=z,e.api=v,e.default=v,Object.defineProperty(e,"__esModule",{value:!0})});
